<div id="{{::post.id}}" ng-repeat="post in PostsCtrl.posts track by post.id" class="post-block" ng-class="{ 'highlighted': post.highlighted, 'hidden': post.hidden, 'deleted': post._deleted }">
  <!-- Delete Post View -->
  <div class="deleted" ng-if="post._deleted">Post Deleted</div>

  <!-- Visible Post View -->
  <div ng-if="!post._deleted">
    <!-- Post Profile Section -->
    <div class="post-user">
      <a ui-sref="profile({ username: post.user.username})">
        <div class="user-avatar">
          <img ng-style="PostsCtrl.avatarHighlight(post.user.highlight_color)" ng-src="{{::post.avatar}}">
        </div>
        <div class="user-role">Hero</div>
      </a>
    </div>

    <!-- Post Body Section -->
    <div class="post-content">
      <!-- Post Title -->
      <div class="post-title">
        <a class="username css-tooltip" data-css-tooltip="{{post.user.role_name || 'User'}}" ui-sref="profile({ username: post.user.username})" ng-style="PostsCtrl.usernameHighlight(post.user.highlight_color)" ng-bind="::post.user.username"></a>
        <div title="::post.user.name" ng-if="post.user.name" class="display-name">
          <span ng-bind-html="::post.user.name | truncate:33"></span>
          <span class="hide-mobile">&nbsp;&mdash;&nbsp;</span>
        </div>
        <div class="timestamp">
          <span ng-bind="::post.created_at | humanDate"></span>
          <span ng-if="PostsCtrl.showEditDate(post)" ng-bind-html="'&nbsp;&mdash;&nbsp;Edited ' + (post.updated_at | humanDate)"></span>
        </div>

        <ul class="post-action">
          <li ng-if="PostsCtrl.controlAccess.privilegedPurge && $index !== 0 && !PostsParentCtrl.bannedFromBoard">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Purge" ng-click="PostsParentCtrl.openPurgeModal($index)">
              <i class="fa fa-trash"></i>
            </a>
          </li>
          <li ng-if="((post.user.id === PostsCtrl.user.id && PostsCtrl.controlAccess.delete) || PostsCtrl.controlAccess.privilegedDelete || (PostsCtrl.thread.user.id === PostsCtrl.user.id && PostsCtrl.thread.moderated && PostsCtrl.moderatedControlAccess)) && $index !== 0 && !post.deleted && !PostsParentCtrl.bannedFromBoard">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Delete" ng-click="PostsParentCtrl.openDeleteModal($index)">
              <i class="fa fa-eye-slash"></i>
            </a>
          </li>
          <li ng-if="((post.user.id === PostsCtrl.user.id && PostsCtrl.controlAccess.undelete) || PostsCtrl.controlAccess.privilegedDelete || (PostsCtrl.thread.user.id === PostsCtrl.user.id && PostsCtrl.thread.moderated && PostsCtrl.moderatedControlAccess)) && post.deleted === true && !PostsParentCtrl.bannedFromBoard">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Undelete" ng-click="PostsParentCtrl.openUndeleteModal($index)">
              <i class="fa fa-eye"></i>
            </a>
          </li>
          <li ng-if="PostsParentCtrl.loggedIn() && post.user.id !== PostsCtrl.user.id && (PostsParentCtrl.reportControlAccess.reportPosts || PostsParentCtrl.reportControlAccess.reportUsers)">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Report" ng-click="PostsCtrl.openReportModal(post)">
              <i class="icon-epoch-flag"></i>
            </a>
          </li>
          <li ng-if="((post.user.id === PostsCtrl.user.id && PostsCtrl.controlAccess.update && !PostsParentCtrl.thread_locked) || PostsCtrl.controlAccess.privilegedUpdate) && !PostsParentCtrl.bannedFromBoard">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Edit" ng-click="PostsCtrl.loadEditor($index)">
              <i class="icon-epoch-edit-pencil"></i>
            </a>
          </li>
          <li ng-if="PostsParentCtrl.loggedIn() && PostsCtrl.controlAccess.create && !PostsParentCtrl.thread_locked && !PostsParentCtrl.bannedFromBoard">
            <a ng-href="#" class="css-tooltip" data-css-tooltip="Quote" ng-click="PostsCtrl.addQuote($index)">
              <i class="icon-epoch-quote"></i>
            </a>
          </li>
          <li>
            <a ng-href="{{::PostsCtrl.rootUrl}}?start={{::post.position}}#{{::post.id}}" ng-click="PostsCtrl.highlightPost()" class="css-tooltip" data-css-tooltip="Permalink">
              <i class="icon-epoch-link"></i>
            </a>
          </li>
        </ul>
        <div class="clear"></div>
      </div>
      <!-- Post Body -->
      <div class="post-body" post-processing="post.body" style-fix="true"></div>
      <div ng-if="post.user.signature">
        <div class="post-sig-border"></div>
        <div class="post-signature" post-processing="post.user.signature" style-fix="true"></div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Post Modal -->
<modal show="PostsParentCtrl.showDeleteModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Delete Post</h3>
    <p>Are you sure you want to delete this post?</p>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.deletePost()">
        Delete Post
      </button>
    </div>
  </form>
</modal>

<!-- Undelete Post Modal -->
<modal show="PostsParentCtrl.showUndeleteModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Undelete Post</h3>
    <p>Are you sure you want to Undelete this post?</p>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.undeletePost()">
        Undelete Post
      </button>
    </div>
  </form>
</modal>

<!-- Purge Post Modal -->
<modal show="PostsParentCtrl.showPurgeModal">
  <form name="$parent.form" class="css-form" novalidate>
    <h3 class="thin-underline">Purge Post</h3>
    <p>Are you sure you want to permanently delete this post?</p>
    <!-- Save Button -->
    <div class="clear">
      <button class="fill-row" ng-click="PostsParentCtrl.purgePost()">
        Purge Post
      </button>
    </div>
  </form>
</modal>
